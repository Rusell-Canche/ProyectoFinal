     1                                 %line 1+1 Proyecto.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 [section .data]
    10                                 
    11                                 
    12                                 LF equ 10
    13                                 NULL equ 0
    14                                 EXIT_SUCCESS equ 0
    15                                 STDIN equ 0
    16                                 STDOUT equ 1
    17                                 STDERR equ 2
    18                                 SYS_read equ 0
    19                                 SYS_write equ 1
    20                                 SYS_open equ 2
    21                                 SYS_close equ 3
    22                                 SYS_exit equ 60
    23                                 SYS_creat equ 85
    24                                 O_RDONLY equ 000000
    25                                 O_WRONLY equ 000001
    26                                 O_CREAT equ 0x40
    27                                 O_TRUNC equ 0x200
    28                                 S_IRUSR equ 00400
    29                                 S_IWUSR equ 00200
    30                                 BUFF_SIZE equ 255
    31                                 MAX_ADN_SIZE equ 100000
    32                                 
    33                                 
    34 00000000 0A00                   newLine db LF, NULL
    35 00000002 416E616C697A61646F-    header db "Analizador de palabras de ADN", LF, LF, NULL
    36 00000002 722064652070616C61-
    37 00000002 627261732064652041-
    38 00000002 444E0A0A00         
    39 00000022 5072756562612E7478-    fileName db "Prueba.txt", NULL
    40 00000022 7400               
    41 0000002D 70616C61627261732E-    outFileName db "palabras.txt", NULL
    42 0000002D 74787400           
    43 0000003A 496E6772657365206C-    promptK db "Ingrese longitud de palabra (4-10): ", NULL
    44 0000003A 6F6E67697475642064-
    45 0000003A 652070616C61627261-
    46 0000003A 2028342D3130293A20-
    47 0000003A 00                 
    48 0000005F 4572726F7220616272-    errMsgOpen db "Error abriendo archivo.", LF, NULL
    49 0000005F 69656E646F20617263-
    50 0000005F 6869766F2E0A00     
    51 00000078 4572726F72206C6579-    errMsgRead db "Error leyendo archivo.", LF, NULL
    52 00000078 656E646F2061726368-
    53 00000078 69766F2E0A00       
    54 00000090 4572726F7220657363-    errMsgWrite db "Error escribiendo archivo.", LF, NULL
    55 00000090 72696269656E646F20-
    56 00000090 6172636869766F2E0A-
    57 00000090 00                 
    58 000000AC 4572726F723A206B20-    errMsgK db "Error: k debe ser entre 4 y 10.", LF, NULL
    59 000000AC 646562652073657220-
    60 000000AC 656E74726520342079-
    61 000000AC 2031302E0A00       
    62 000000CD 50616C616272617320-    successMsg db "Palabras guardadas en palabras.txt", LF, NULL
    63 000000CD 677561726461646173-
    64 000000CD 20656E2070616C6162-
    65 000000CD 7261732E7478740A00 
    66                                 
    67                                 
    68                                 [section .bss]
    69 00000000 <gap>                  readBuffer resb BUFF_SIZE
    70 000000FF <gap>                  adnBuffer resb MAX_ADN_SIZE
    71 0001879F 0000000000000000       fileDesc dq 0
    72 000187A7 0000000000000000       outFileDesc dq 0
    73 000187AF <gap>                  kVal resb 1
    74 000187B0 <gap>                  adnLength resq 1
    75                                 
    76                                 
    77                                 [section .text]
    78                                 [global _start]
    79                                 
    80                                 _start:
    81                                 
    82 00000000 48C7C7[00000000]        mov rdi, header
    83 00000007 E85A020000              call printStr
    84                                 
    85                                 
    86 0000000C E85F000000              call openInputFile
    87 00000011 4883F800                cmp rax, 0
    88 00000015 7C4C                    jl _exitError
    89                                 
    90                                 
    91 00000017 E887000000              call readFASTA
    92 0000001C 4883F800                cmp rax, 0
    93 00000020 7C41                    jl _exitError
    94                                 
    95                                 
    96 00000022 48C7C003000000          mov rax, SYS_close
    97 00000029 488B3C25[00000000]      mov rdi, [fileDesc]
    98 00000031 0F05                    syscall
    99                                 
   100                                 
   101 00000033 E812010000              call getKValue
   102 00000038 4883F800                cmp rax, 0
   103 0000003C 7C25                    jl _exitError
   104                                 
   105                                 
   106 0000003E E867010000              call generateWords
   107 00000043 4883F800                cmp rax, 0
   108 00000047 7C1A                    jl _exitError
   109                                 
   110                                 
   111 00000049 48C7C7[00000000]        mov rdi, successMsg
   112 00000050 E811020000              call printStr
   113                                 
   114                                 
   115 00000055 48C7C03C000000          mov rax, SYS_exit
   116 0000005C 48C7C700000000          mov rdi, EXIT_SUCCESS
   117 00000063 0F05                    syscall
   118                                 
   119                                 _exitError:
   120                                 
   121 00000065 48C7C03C000000          mov rax, SYS_exit
   122 0000006C 48C7C701000000          mov rdi, 1
   123 00000073 0F05                    syscall
   124                                 
   125                                 
   126                                 
   127                                 
   128                                 openInputFile:
   129 00000075 48C7C002000000          mov rax, SYS_open
   130 0000007C 48C7C7[00000000]        mov rdi, fileName
   131 00000083 48C7C600000000          mov rsi, O_RDONLY
   132 0000008A 0F05                    syscall
   133 0000008C 4883F800                cmp rax, 0
   134 00000090 7C07                    jl .error
   135 00000092 48890425[00000000]      mov [fileDesc], rax
   136 0000009A C3                      ret
   137                                 .error:
   138 0000009B 48C7C7[00000000]        mov rdi, errMsgOpen
   139 000000A2 E8BF010000              call printStr
   140 000000A7 C3                      ret
   141                                 
   142                                 
   143                                 
   144                                 
   145                                 readFASTA:
   146 000000A8 4D31FF                  xor r15, r15
   147 000000AB 4D31E4                  xor r12, r12
   148                                 
   149                                 .readLoop:
   150                                 
   151 000000AE 48C7C000000000          mov rax, SYS_read
   152 000000B5 488B3C25[00000000]      mov rdi, [fileDesc]
   153 000000BD 48C7C6[00000000]        mov rsi, readBuffer
   154 000000C4 48C7C2FF000000          mov rdx, BUFF_SIZE
   155 000000CB 0F05                    syscall
   156                                 
   157                                 
   158 000000CD 4883F800                cmp rax, 0
   159 000000D1 7C5A                    jl .readError
   160 000000D3 746C                    je .done
   161                                 
   162                                 
   163 000000D5 4989C6                  mov r14, rax
   164 000000D8 4D31ED                  xor r13, r13
   165                                 
   166                                 .processByte:
   167 000000DB 4D39F5                  cmp r13, r14
   168 000000DE 7DCC                    jge .readLoop
   169                                 
   170 000000E0 418A85[00000000]        mov al, [readBuffer + r13]
   171 000000E7 49FFC5                  inc r13
   172                                 
   173                                 
   174 000000EA 4D85E4                  test r12, r12
   175 000000ED 7531                    jnz .headerSection
   176                                 
   177                                 
   178 000000EF 3C3E                    cmp al, '>'
   179 000000F1 7424                    je .startHeader
   180 000000F3 3C0A                    cmp al, LF
   181 000000F5 7434                    je .nextByte
   182 000000F7 3C3B                    cmp al, ';'
   183 000000F9 7430                    je .nextByte
   184                                 
   185                                 
   186 000000FB 3C41                    cmp al, 'A'
   187 000000FD 722C                    jb .nextByte
   188 000000FF 3C7A                    cmp al, 'z'
   189 00000101 7728                    ja .nextByte
   190                                 
   191                                 
   192 00000103 3C61                    cmp al, 'a'
   193 00000105 7204                    jb .storeChar
   194 00000107 3C7A                    cmp al, 'z'
   195 00000109 7700                    ja .storeChar
   196 0000010B 2C20                    sub al, 32
   197                                 
   198                                 .storeChar:
   199                                 
   200 0000010D 418887[00000000]        mov [adnBuffer + r15], al
   201 00000114 49FFC7                  inc r15
   202 00000117 EB12                    jmp .nextByte
   203                                 
   204                                 .startHeader:
   205 00000119 49C7C401000000          mov r12, 1
   206 00000120 EB09                    jmp .nextByte
   207                                 
   208                                 .headerSection:
   209                                 
   210 00000122 3C0A                    cmp al, LF
   211 00000124 7505                    jne .nextByte
   212 00000126 49C7C400000000          mov r12, 0
   213                                 
   214                                 .nextByte:
   215 0000012D EBAA                    jmp .processByte
   216                                 
   217                                 .readError:
   218 0000012F 48C7C7[00000000]        mov rdi, errMsgRead
   219 00000136 E82B010000              call printStr
   220 0000013B 48C7C0FFFFFFFF          mov rax, -1
   221 00000142 C3                      ret
   222                                 
   223                                 .done:
   224                                 
   225 00000143 4C893C25[00000000]      mov [adnLength], r15
   226 0000014B 4831C0                  xor rax, rax
   227 0000014E C3                      ret
   228                                 
   229                                 
   230                                 
   231                                 getKValue:
   232                                 
   233 0000014F 48C7C7[00000000]        mov rdi, promptK
   234 00000156 E80B010000              call printStr
   235                                 
   236                                 
   237 0000015B 48C7C000000000          mov rax, SYS_read
   238 00000162 48C7C700000000          mov rdi, STDIN
   239 00000169 48C7C6[00000000]        mov rsi, readBuffer
   240 00000170 48C7C203000000          mov rdx, 3
   241 00000177 0F05                    syscall
   242                                 
   243                                 
   244 00000179 4883F801                cmp rax, 1
   245 0000017D 7E1A                    jle .invalidK
   246                                 
   247                                 
   248 0000017F 8A0425[00000000]        mov al, [readBuffer]
   249 00000186 2C30                    sub al, '0'
   250                                 
   251                                 
   252 00000188 3C04                    cmp al, 4
   253 0000018A 720D                    jb .invalidK
   254 0000018C 3C0A                    cmp al, 10
   255 0000018E 7709                    ja .invalidK
   256                                 
   257                                 
   258 00000190 880425[00000000]        mov [kVal], al
   259 00000197 4831C0                  xor rax, rax
   260 0000019A C3                      ret
   261                                 
   262                                 .invalidK:
   263 0000019B 48C7C7[00000000]        mov rdi, errMsgK
   264 000001A2 E8BF000000              call printStr
   265 000001A7 48C7C0FFFFFFFF          mov rax, -1
   266 000001AE C3                      ret
   267                                 
   268                                 
   269                                 
   270                                 generateWords:
   271                                 
   272 000001AF 48C7C055000000          mov rax, SYS_creat
   273 000001B6 48C7C7[00000000]        mov rdi, outFileName
   274 000001BD 48C7C680010000          mov rsi, S_IRUSR | S_IWUSR
   275 000001C4 0F05                    syscall
   276 000001C6 4883F800                cmp rax, 0
   277 000001CA 0F8C81000000            jl .writeError
   278 000001D0 48890425[00000000]      mov [outFileDesc], rax
   279                                 
   280                                 
   281 000001D8 480FB60C25[00000000]      movzx rcx, byte [kVal]
   282 000001E1 4C8B3425[00000000]      mov r14, [adnLength]
   283 000001E9 4929CE                  sub r14, rcx
   284 000001EC 49FFC6                  inc r14
   285 000001EF 4D31FF                  xor r15, r15
   286                                 
   287                                 
   288                                 .wordLoop:
   289 000001F2 4D39F7                  cmp r15, r14
   290 000001F5 7D49                    jge .closeFile
   291                                 
   292                                 
   293 000001F7 48C7C001000000          mov rax, SYS_write
   294 000001FE 488B3C25[00000000]      mov rdi, [outFileDesc]
   295 00000206 498DB7[00000000]        lea rsi, [adnBuffer + r15]
   296 0000020D 4889CA                  mov rdx, rcx
   297 00000210 0F05                    syscall
   298 00000212 4883F800                cmp rax, 0
   299 00000216 7C3D                    jl .writeError
   300                                 
   301                                 
   302 00000218 48C7C001000000          mov rax, SYS_write
   303 0000021F 488B3C25[00000000]      mov rdi, [outFileDesc]
   304 00000227 48C7C6[00000000]        mov rsi, newLine
   305 0000022E 48C7C201000000          mov rdx, 1
   306 00000235 0F05                    syscall
   307 00000237 4883F800                cmp rax, 0
   308 0000023B 7C18                    jl .writeError
   309                                 
   310 0000023D 49FFC7                  inc r15
   311 00000240 EBAE                    jmp .wordLoop
   312                                 
   313                                 .closeFile:
   314                                 
   315 00000242 48C7C003000000          mov rax, SYS_close
   316 00000249 488B3C25[00000000]      mov rdi, [outFileDesc]
   317 00000251 0F05                    syscall
   318 00000253 4831C0                  xor rax, rax
   319 00000256 C3                      ret
   320                                 
   321                                 .writeError:
   322 00000257 48C7C7[00000000]        mov rdi, errMsgWrite
   323 0000025E E803000000              call printStr
   324 00000263 48C7C0FFFFFFFF          mov rax, -1
   325 0000026A C3                      ret
   326                                 
   327                                 
   328                                 
   329                                 
   330                                 printStr:
   331 0000026B 53                      push rbx
   332                                 
   333 0000026C 4889FB                  mov rbx, rdi
   334 0000026F 48C7C200000000          mov rdx, 0
   335                                 .strCountLoop:
   336 00000276 803B00                  cmp byte [rbx], NULL
   337 00000279 7406                    je .strDone
   338 0000027B 48FFC2                  inc rdx
   339 0000027E 48FFC3                  inc rbx
   340 00000281 EBF1                    jmp .strCountLoop
   341                                 
   342                                 .strDone:
   343 00000283 4883FA00                cmp rdx, 0
   344 00000287 7411                    je .printDone
   345                                 
   346 00000289 48C7C001000000          mov rax, SYS_write
   347 00000290 4889FE                  mov rsi, rdi
   348 00000293 48C7C701000000          mov rdi, STDOUT
   349 0000029A 0F05                    syscall
   350                                 
   351                                 .printDone:
   352 0000029C 5B                      pop rbx
   353 0000029D C3                      ret

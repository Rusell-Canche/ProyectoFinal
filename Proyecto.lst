     1                                 %line 1+1 Proyecto.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 [section .data]
    10                                 
    11                                 
    12                                 LF equ 10
    13                                 NULL equ 0
    14                                 TRUE equ 1
    15                                 FALSE equ 0
    16                                 EXIT_SUCCESS equ 0
    17                                 STDIN equ 0
    18                                 STDOUT equ 1
    19                                 STDERR equ 2
    20                                 SYS_read equ 0
    21                                 SYS_write equ 1
    22                                 SYS_open equ 2
    23                                 SYS_close equ 3
    24                                 SYS_fork equ 57
    25                                 SYS_exit equ 60
    26                                 SYS_creat equ 85
    27                                 SYS_time equ 201
    28                                 O_CREAT equ 0x40
    29                                 O_TRUNC equ 0x200
    30                                 O_APPEND equ 0x400
    31                                 O_RDONLY equ 000000
    32                                 O_WRONLY equ 000001
    33                                 O_RDWR equ 000002
    34                                 S_IRUSR equ 00400
    35                                 S_IWUSR equ 00200
    36                                 S_IXUSR equ 00100
    37                                 
    38                                 
    39                                 BUFF_SIZE equ 255
    40 00000000 0A00                   newLine db LF, NULL
    41 00000002 0A46696C6520526561-    header db LF, "File Read Example."
    42 00000002 64204578616D706C65-
    43 00000002 2E                 
    44 00000015 0A0A00                  db LF, LF, NULL
    45 00000018 5072756562612E7478-    fileName db "Prueba.txt", NULL
    46 00000018 7400               
    47 00000023 0000000000000000       fileDesc dq 0
    48 0000002B 4572726F72206F7065-    errMsgOpen db "Error opening the file.", LF, NULL
    49 0000002B 6E696E672074686520-
    50 0000002B 66696C652E0A00     
    51 00000044 4572726F7220726561-    errMsgRead db "Error reading from the file.", LF, NULL
    52 00000044 64696E672066726F6D-
    53 00000044 207468652066696C65-
    54 00000044 2E0A00             
    55                                 
    56                                 
    57                                 [section .bss]
    58 00000000 <gap>                  readBuffer resb BUFF_SIZE
    59                                 
    60                                 [extern fprintStr]
    61                                 
    62                                 
    63                                 
    64                                 [section .text]
    65                                 [global _start]
    66                                 
    67                                 _start:
    68                                 
    69                                 
    70                                 
    71 00000000 48C7C7[00000000]       mov rdi, header
    72 00000007 E8A7000000             call printStr
    73                                 
    74                                 
    75                                 
    76                                 
    77                                 
    78                                 
    79                                 
    80                                 
    81                                 
    82                                 
    83                                 
    84                                 
    85                                 
    86                                 
    87                                 openInputFile:
    88 0000000C 48C7C002000000         mov rax, SYS_open
    89 00000013 48C7C7[00000000]       mov rdi, fileName
    90 0000001A 48C7C600000000         mov rsi, O_RDONLY
    91 00000021 0F05                   syscall
    92 00000023 4883F800               cmp rax, 0
    93 00000027 7C61                   jl errorOnOpen
    94 00000029 48890425[00000000]     mov qword [fileDesc], rax
    95                                 
    96                                 
    97                                 
    98                                 
    99                                 
   100                                 
   101                                 
   102                                 
   103                                 
   104                                 
   105                                 
   106                                 
   107 00000031 48C7C000000000         mov rax, SYS_read
   108 00000038 488B3C25[00000000]     mov rdi, qword [fileDesc]
   109 00000040 48C7C6[00000000]       mov rsi, readBuffer
   110 00000047 48C7C2FF000000         mov rdx, BUFF_SIZE
   111 0000004E 0F05                   syscall
   112 00000050 4883F800               cmp rax, 0
   113 00000054 7C42                   jl errorOnRead
   114                                 
   115                                 
   116                                 
   117                                 
   118 00000056 48C7C6[00000000]       mov rsi, readBuffer
   119 0000005D C6040600               mov byte [rsi+rax], NULL
   120 00000061 48C7C7[00000000]       mov rdi, readBuffer
   121 00000068 E846000000             call printStr
   122                                 
   123 0000006D 48C7C7[00000000]       mov rdi, newLine
   124 00000074 E83A000000             call printStr
   125                                 
   126                                 
   127                                 
   128                                 
   129                                 
   130                                 
   131                                 
   132 00000079 48C7C003000000         mov rax, SYS_close
   133 00000080 488B3C25[00000000]     mov rdi, qword [fileDesc]
   134 00000088 0F05                   syscall
   135 0000008A EB1A                   jmp last
   136                                 
   137                                 
   138                                 
   139                                 
   140                                 
   141                                 errorOnOpen:
   142 0000008C 48C7C7[00000000]       mov rdi, errMsgOpen
   143 00000093 E81B000000             call printStr
   144 00000098 EB0C                   jmp last
   145                                 
   146                                 
   147                                 
   148                                 
   149                                 errorOnRead:
   150 0000009A 48C7C7[00000000]       mov rdi, errMsgRead
   151 000000A1 E80D000000             call printStr
   152 000000A6 EBFE                   jmp last
   153                                 last:
   154 000000A8 48C7C03C000000          mov rax, SYS_exit
   155 000000AF 48C7C700000000          mov rdi, EXIT_SUCCESS
   156 000000B6 0F05                    syscall
   157                                 
   158                                 
   159                                 
   160                                 
   161                                 
   162                                 
   163                                 
   164                                 
   165                                 [global printStr]
   166                                 printStr:
   167 000000B8 53                      push rbx
   168                                 
   169 000000B9 4889FB                  mov rbx,rdi
   170 000000BC 48C7C200000000          mov rdx,0
   171                                  strCountL:
   172 000000C3 803B00                  cmp byte [rbx],NULL
   173 000000C6 7406                    je strDone
   174 000000C8 48FFC2                  inc rdx
   175 000000CB 48FFC3                  inc rbx
   176 000000CE EBF1                    jmp strCountL
   177                                 
   178                                  strDone:
   179 000000D0 4883FA00                cmp rdx,0
   180 000000D4 7411                    je ptrDone
   181                                 
   182 000000D6 48C7C001000000          mov rax, SYS_write
   183 000000DD 4889FE                  mov rsi, rdi
   184 000000E0 48C7C701000000          mov rdi,STDOUT
   185 000000E7 0F05                    syscall
   186                                 
   187                                  ptrDone:
   188 000000E9 5B                      pop rbx
   189 000000EA C3                      ret
